#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –ø–æ PID

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–∞ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –æ—Ç–∫—É–¥–∞ –∑–∞–ø—É—â–µ–Ω)
cd "$(dirname "$0")" || exit 1

PID_FILE="web.pid"

if [ ! -f "$PID_FILE" ]; then
    echo "‚ùå –§–∞–π–ª PID –Ω–µ –Ω–∞–π–¥–µ–Ω. –í–µ–±-—Å–µ—Ä–≤–µ—Ä, –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ –∑–∞–ø—É—â–µ–Ω."
    exit 1
fi

WEB_PID=$(cat $PID_FILE)

if [ -z "$WEB_PID" ]; then
    echo "PID –≤ —Ñ–∞–π–ª–µ –ø—É—Å—Ç. –í–µ–±-—Å–µ—Ä–≤–µ—Ä, –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ –∑–∞–ø—É—â–µ–Ω."
    rm -f $PID_FILE
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å
if ps -p $WEB_PID > /dev/null; then
    echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –≤–µ–±-—Å–µ—Ä–≤–µ—Ä —Å PID: $WEB_PID"
    kill $WEB_PID

    # –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
    sleep 2

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å
    if ps -p $WEB_PID > /dev/null; then
        echo "‚ö†Ô∏è  –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∞—é..."
        kill -9 $WEB_PID
    fi

    # –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª PID
    rm -f $PID_FILE
    echo "‚úÖ –í–µ–±-—Å–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."
else
    echo "‚ö†Ô∏è  –ü—Ä–æ—Ü–µ—Å—Å —Å PID $WEB_PID –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–¥–∞–ª—è—é —Ñ–∞–π–ª PID."
    rm -f $PID_FILE
fi
