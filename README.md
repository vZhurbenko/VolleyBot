# Volleyball Poll Bot

Telegram-бот для создания еженедельных опросов о посещении волейбольных тренировок.

## Возможности

- Создание опросов с вариантами: «Буду», «50/50», «Не буду»
- Автоматическое создание опросов по расписанию
- Закрепление опросов в чате
- Поддержка топиков (тем) в чатах
- Несколько администраторов
- Настройка через Telegram

## Требования

- Python 3.8+
- Виртуальное окружение (venv)

## Установка

### 1. Создайте бота в Telegram

1. Откройте @BotFather в Telegram
2. Отправьте команду `/newbot`
3. Введите имя бота (например, `Volleyball Poll Bot`)
4. Введите username бота (должен заканчиваться на `bot`, например `VolleyPollBot`)
5. Сохраните полученный токен (выглядит как `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

### 2. Узнайте свой Telegram ID

1. Откройте @userinfobot или @myidbot
2. Отправьте команду `/start`
3. Бот покажет ваш ID (число, например `118295767`)

### 3. Добавьте бота в чат

1. Откройте чат/группу где будут опросы
2. Добавьте бота как участника
3. Назначьте бота администратором (чтобы мог закреплять сообщения)

### 4. Узнайте Chat ID и Topic ID

**Для обычного чата:**
1. Отправьте любое сообщение в чат
2. Перешлите это сообщение боту @rawdata_bot
3. Найдите `"chat":{"id": -100XXXXXXXXXX}` — это Chat ID

**Для топика (темы):**
1. Откройте тему в чате
2. Отправьте сообщение в теме
3. Перешлите боту @rawdata_bot
4. Найдите `"message_thread_id": XXXXX` — это Topic ID

### 5. Настройка и запуск

```bash
# Клонируйте репозиторий
git clone https://github.com/vZhurbenko/VolleyBot.git
cd VolleyBot

# Создайте виртуальное окружение
python3 -m venv venv
source venv/bin/activate

# Установите зависимости
pip install -r requirements.txt

# Создайте файл с токеном
echo "ВАШ_ТОКЕН_БОТА" > .bot_token

# Инициализируйте базу данных
python3 init_db.py
```

Скрипт `init_db.py` запросит:
- Telegram ID администраторов (через запятую)
- Место проведения тренировки
- Время тренировки (формат: `18:00 - 20:00`)
- Варианты ответов (через `, `)
- Chat ID для опросов
- Topic ID (опционально, Enter для пропуска)

### 6. Запуск бота

```bash
# Запуск в фоне
./start_bot.sh

# Проверка логов
cat bot_output.log

# Остановка бота
./stop_bot_by_pid.sh
```

## Структура проекта

```
├── bot.py              # Основной код бота
├── database.py         # Работа с SQLite
├── init_db.py          # Скрипт инициализации БД
├── start_bot.sh        # Запуск в фоне
├── stop_bot_by_pid.sh  # Остановка бота
├── requirements.txt    # Зависимости
└── README.md           # Документация
```

## Команды

- `/start` — главное меню
- `/getid` — узнать свой ID
- `/stop_bot` — остановить бота (администраторам)

## Настройка расписания

Расписание настраивается через бота в Telegram:
1. Отправьте `/start`
2. Выберите «⚙️ Настройки» → управление расписаниями

По умолчанию опросы создаются по вторникам для тренировок в понедельник.

## Зависимости

- python-telegram-bot
- APScheduler
- SQLite3 (встроен в Python)

## Авторы

@vzhurbenko
